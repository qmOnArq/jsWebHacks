{"version":3,"file":"exp_pnp.js","mappings":"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","sources":["webpack://jswebhacks/./src/helpers.ts","webpack://jswebhacks/./src/exp_pnp/components/delete-all-initiatives-button.ts","webpack://jswebhacks/./src/exp_pnp/components/mass-import-initiatives-button.ts","webpack://jswebhacks/./src/exp_pnp/main.ts","webpack://jswebhacks/./src/exp_pnp/scripts/helpers.ts","webpack://jswebhacks/./src/exp_pnp/scripts/project-functions.ts","webpack://jswebhacks/./src/deferred.ts","webpack://jswebhacks/./src/exp_pnp/scripts/initiative-functions.ts","webpack://jswebhacks/./src/exp_pnp/components/download-all-initiatives-button.ts","webpack://jswebhacks/webpack/bootstrap","webpack://jswebhacks/./src/exp_pnp/index.ts"],"sourcesContent":["import { Deferred } from './deferred';\n\nexport async function asyncForEach<T>(\n    array: ArrayLike<T>,\n    callback: (item: T, index: number, list: ArrayLike<T>) => Promise<unknown>,\n) {\n    for (let index = 0; index < array.length; index++) {\n        await callback(array[index], index, array);\n    }\n}\n\nexport function readFileAsText(file: File): Promise<string> {\n    const result = new Deferred<string>();\n\n    const reader = new FileReader();\n    reader.onload = event => {\n        result.resolve(event?.target?.result);\n    };\n    reader.readAsText(file);\n\n    return result.promise;\n}\n\nexport function sleep(ms: number): Promise<void> {\n    const result = new Deferred<void>();\n\n    setTimeout(() => {\n        result.resolve();\n    }, ms);\n\n    return result.promise;\n}\n\nexport default function retry<T>(\n    fn: () => Promise<T>,\n    conditionFn: (input: T) => boolean,\n    options: RetryingOptions = { waitingInterval: 5000, maxTries: 10 },\n): Promise<T> {\n    function tryToGetResult(retry: number): Promise<T> {\n        return fn().then(result => {\n            if (conditionFn(result)) {\n                return result;\n            }\n            if (retry <= options.maxTries) {\n                // sleep the specified time\n                return sleep(options.waitingInterval).then(() => tryToGetResult(retry + 1));\n            } else {\n                throw new Error(`Retrying failed after ${options.maxTries} tries.`);\n            }\n        });\n    }\n\n    return tryToGetResult(1);\n}\n\nexport interface RetryingOptions {\n    waitingInterval: number;\n    maxTries: number;\n}\n\nexport function objectFromEntries(arr: any[]) {\n    return Object.assign(\n        {},\n        ...Array.from(arr, ([key, value]) => {\n            return { [key]: value };\n        }),\n    );\n}\n\nexport function objectFilter(obj: any, filterFn: ([key, value]: any) => boolean) {\n    return objectFromEntries(Object.entries(obj).filter(filterFn));\n}\n","import { InitiativeExportData, InitiativeListItem } from '../types/initiative.type';\nimport { asyncForEach } from '../../helpers';\nimport { PNPProject } from '../scripts/project-functions';\nimport { PNPHelpers } from '../scripts/helpers';\nimport { PNPInitiative } from '../scripts/initiative-functions';\n\nlet total = 0;\nlet current = 0;\n\nexport namespace PNPDeleteAllButton {\n    export const create = createButton;\n    export const setEnabled = setButtonEnabled;\n}\n\nfunction createButton() {\n    if (document.querySelector('#DELETE_ALL_INITIATIVES_BUTTON_WRAPPER')) {\n        return;\n    }\n    const button = document.createElement('e-ui-button');\n    button.id = 'DELETE_ALL_INITIATIVES_BUTTON_WRAPPER';\n    button.setAttribute('priority', 'danger');\n    button.classList.add('ui');\n    button.classList.add('ui-node');\n    button.innerHTML = `\n        <button class=\"button-wrapper\" id=\"DELETE_ALL_INITIATIVES_BUTTON\">\n            <span id=\"DELETE_ALL_INITIATIVES_BUTTON_TEXT\" class=\"button-text\">Delete all</span>\n        </button>\n    `;\n    document.querySelector(PNPHelpers.headerSelector)!.prepend(button);\n    PNPHelpers.setButtonStatus(false);\n    updateButtonLabel();\n}\n\nfunction setButtonEnabled(enabled: boolean) {\n    const wrapper = document.querySelector('#DELETE_ALL_INITIATIVES_BUTTON_WRAPPER');\n    if (!wrapper) {\n        return;\n    }\n    wrapper.classList.remove('disabled');\n    if (!enabled) {\n        wrapper.classList.add('disabled');\n    }\n    const button = document.querySelector('#DELETE_ALL_INITIATIVES_BUTTON_WRAPPER') as HTMLButtonElement;\n    if (!button) {\n        return;\n    }\n    if (enabled) {\n        button.onclick = () => {\n            deleteAllInitiatives();\n        };\n    } else {\n        button.onclick = null;\n    }\n}\n\nfunction updateButtonLabel() {\n    const text = document.querySelector('#DELETE_ALL_INITIATIVES_BUTTON_TEXT');\n    if (!text) {\n        return;\n    }\n    text.innerHTML = 'Delete all';\n    if (total > 0) {\n        text.innerHTML += ` ${current} / ${total}`;\n    }\n}\n\nasync function deleteAllInitiatives() {\n    const project = PNPProject.getProjectData();\n    if (!project) {\n        PNPHelpers.handleError('Could not find Project ID');\n        return;\n    }\n    PNPHelpers.setButtonStatus(false);\n    const list = await PNPInitiative.getInitiativeList(project._id);\n    current = 0;\n    total = list.length;\n\n    if (\n        prompt(\n            `You are about to delete ${total} initiative${total > 1 ? 's' : ''}. Rewrite the amount to continue.`,\n        ) !== `${total}`\n    ) {\n        alert('Canceling deletion');\n        PNPHelpers.setButtonStatus(true);\n        return;\n    }\n\n    updateButtonLabel();\n    const failedInitiatives: [InitiativeListItem, InitiativeExportData | null][] = [];\n\n    await asyncForEach(list, async initiative => {\n        const response = await PNPInitiative.deleteInitiative(initiative._id, project._id);\n        current++;\n        updateButtonLabel();\n        if (!response) {\n            failedInitiatives.push([initiative, null]);\n            return;\n        }\n        if (!response.success) {\n            failedInitiatives.push([initiative, null]);\n            return;\n        }\n    });\n    failedInitiatives.forEach(fail => {\n        PNPHelpers.handleError(`${fail[0].name} (${fail[0]._id}) delete failed`, fail[1]);\n    });\n    PNPHelpers.setButtonStatus(true);\n    total = 0;\n    updateButtonLabel();\n\n    alert('Refresh the page to reload the list of initiatives');\n}\n","import { PNPHelpers } from '../scripts/helpers';\nimport * as JSZipType from 'jszip';\nimport { asyncForEach, readFileAsText, sleep } from '../../helpers';\nimport { PNPProject } from '../scripts/project-functions';\nimport { PNPInitiative } from '../scripts/initiative-functions';\n\ndeclare const JSZip: JSZipType;\n\nlet total = 0;\nlet current = 0;\n\nexport namespace PNPMassImportButton {\n    export const create = createButton;\n    export const setEnabled = setButtonEnabled;\n}\n\nfunction createButton() {\n    if (document.querySelector('#IMPORT_ALL_INITIATIVES_BUTTON_WRAPPER')) {\n        return;\n    }\n    const button = document.createElement('e-ui-button');\n    button.id = 'IMPORT_ALL_INITIATIVES_BUTTON_WRAPPER';\n    button.setAttribute('priority', 'secondary');\n    button.classList.add('ui');\n    button.classList.add('ui-node');\n    button.innerHTML = `\n        <button class=\"button-wrapper\" id=\"IMPORT_ALL_INITIATIVES_BUTTON\">\n            <span id=\"IMPORT_ALL_INITIATIVES_BUTTON_TEXT\" class=\"button-text\">Mass import</span>\n        </button>\n    `;\n    document.querySelector(PNPHelpers.headerSelector)!.prepend(button);\n    PNPHelpers.setButtonStatus(false);\n    updateButtonLabel();\n}\n\nfunction setButtonEnabled(enabled: boolean) {\n    const wrapper = document.querySelector('#IMPORT_ALL_INITIATIVES_BUTTON_WRAPPER');\n    if (!wrapper) {\n        return;\n    }\n    wrapper.classList.remove('disabled');\n    if (!enabled) {\n        wrapper.classList.add('disabled');\n    }\n    const button = document.querySelector('#IMPORT_ALL_INITIATIVES_BUTTON_WRAPPER') as HTMLButtonElement;\n    if (!button) {\n        return;\n    }\n    if (enabled) {\n        button.onclick = () => {\n            setModalVisible(true);\n        };\n    } else {\n        button.onclick = null;\n    }\n}\n\nfunction updateButtonLabel() {\n    const text = document.querySelector('#IMPORT_ALL_INITIATIVES_BUTTON_TEXT');\n    if (!text) {\n        return;\n    }\n    text.innerHTML = 'Mass import';\n    if (total > 0) {\n        text.innerHTML += ` ${current} / ${total}`;\n    }\n}\n\nasync function startMassImport(files: FileList) {\n    const project = PNPProject.getProjectData();\n    if (!project) {\n        PNPHelpers.handleError('Could not find Project ID');\n        return;\n    }\n\n    total = 0;\n    current = 0;\n\n    updateButtonLabel();\n    PNPHelpers.setButtonStatus(false);\n\n    const jsons: string[] = [];\n    const fails: unknown[] = [];\n\n    await asyncForEach(files, async item => await handleFile(item));\n    await asyncForEach(jsons, async json => await importJson(json));\n\n    fails.forEach(fail => {\n        PNPHelpers.handleError(`Import failed`, fail);\n    });\n\n    total = 0;\n    updateButtonLabel();\n    PNPHelpers.setButtonStatus(true);\n\n    alert('Refresh the page to reload the list of initiatives');\n\n    async function handleFile(file: File) {\n        try {\n            const zip = await JSZip.loadAsync(file);\n            const fileKeys = Object.keys(zip.files);\n            await asyncForEach(fileKeys, async fileKey => {\n                const f = zip.files[fileKey];\n                if (!f.dir) {\n                    jsons.push(await f.async('text'));\n                    total++;\n                    updateButtonLabel();\n                }\n            });\n        } catch (e) {\n            // Not zip file\n            jsons.push(await readFileAsText(file));\n            total++;\n            updateButtonLabel();\n        }\n    }\n\n    async function importJson(json: string) {\n        const result = await PNPInitiative.importInitiativeJson(json, project!._id);\n        await sleep(500);\n        current++;\n        updateButtonLabel();\n\n        if (result?.errors) {\n            fails.push(result.errors);\n            return;\n        }\n    }\n}\n\nfunction setModalVisible(open: boolean) {\n    if (open) {\n        createMassImportModal();\n        const modal = document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL') as HTMLElement;\n        modal.style.display = 'block';\n        const fileInput = document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL_FILE_INPUT') as HTMLInputElement;\n        fileInput.value = '';\n        fileInput.onchange!(null as any);\n    } else {\n        const modal = document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL') as HTMLElement | null;\n        if (modal) {\n            modal.style.display = 'none';\n        }\n    }\n}\n\nfunction createMassImportModal() {\n    if (document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL')) {\n        return;\n    }\n\n    const wrapper = document.createElement('div');\n    wrapper.id = 'IMPORT_ALL_INITIATIVES_MODAL';\n    wrapper.style.position = 'fixed';\n    wrapper.style.left = '0';\n    wrapper.style.right = '0';\n    wrapper.style.top = '0';\n    wrapper.style.bottom = '0';\n    wrapper.style.display = 'none';\n    wrapper.innerHTML = `\n        <div\n            style=\"\n                display: flex;\n                align-items: flex-start;\n                position: absolute;\n                top: 0;\n                right: 0;\n                bottom: 0;\n                left: 0;\n                z-index: 0;\n                background-color: rgba(28,23,51,.8);\n            \"\n        >\n        </div>\n\n        <div\n            style=\"\n                top: 10%;\n                left: 50%;\n                width: 560px;\n                margin-left: -280px;\n                background-color: #fff;\n                border: 1px solid rgba(0,0,0,.3);\n                border-radius: 4px;\n                outline: 0;\n                box-shadow: 0 3px 7px rgba(0,0,0,.3);\n                background-clip: padding-box;\n                position: fixed;\n                overflow: visible;\n            \"\n        >\n            <div\n                style=\"\n                    border-bottom: 1px solid rgba(201,207,231,.5);\n                    padding: 21px 25px 20px 30px;\n                \"\n            >\n                <h3\n                    style=\"\n                        padding: 0;\n                        margin: 0;\n                    \"\n                >Mass import initiatives</h3>\n            </div>\n\n            <div\n                style=\"\n                    padding: 15px 30px;\n                    overflow-y: visible;\n                    max-height: calc(100vh - 150px);\n                    position: relative;\n                \"\n            >\n                <label\n                    id=\"IMPORT_ALL_INITIATIVES_MODAL_FILE_LABEL\"\n                    style=\"\n                        text-align: center;\n                        background-color: #fafafd;\n                        border: 1px dashed #d8ddef;\n                        border-radius: 2px;\n                        padding: 10px 20px;\n                        box-sizing: border-box;\n                        display: block;\n                        position: relative;\n                    \"\n                >\n                    <span\n                        style=\"\n                            display: block;\n                            font-weight: 700;\n                            font-size: 14px;\n                            color: #636696;\n                            margin: 20px;\n                        \"\n                    >\n                        <span>Drag & drop (or click to open picker)</span>\n                        <br>\n                        <br>\n                        <i style=\"font-weight: 400\">.zip or single/multiple .json files allowed</i>\n                        <br>\n                        <br>\n                        <span id=\"IMPORT_ALL_INITIATIVES_MODAL_FILE_INPUT_MESSAGE\">No files selected</span>\n                    </span>\n                    <input\n                        style=\"\n                            position: absolute;\n                            left: 0;\n                            top: 0;\n                            right: 0;\n                            display: block;\n                            bottom: 0;\n                            width: 100%;\n                            height: 100%;\n                            opacity: 0;\n                            cursor: pointer;\n                        \"\n                        type=\"file\" multiple id=\"IMPORT_ALL_INITIATIVES_MODAL_FILE_INPUT\">\n                </label>\n            </div>\n\n            <div\n                style=\"\n                    border-radius: 0 0 4px 4px;\n                    padding: 12px 30px;\n                    background: #f8f7fd;\n                    margin-bottom: 0;\n                    text-align: right;\n                \"\n            >\n                <e-ui-button class=\"ui ui-node\" id=\"IMPORT_ALL_INITIATIVES_MODAL_CANCEL_BUTTON\">\n                    <button class=\"button-wrapper\">\n                        <span class=\"button-text\">Cancel</span>\n                    </button>\n                </e-ui-button>\n\n                <e-ui-button class=\"ui ui-node\" priority=\"primary\" id=\"IMPORT_ALL_INITIATIVES_MODAL_IMPORT_BUTTON\">\n                    <button class=\"button-wrapper\">\n                        <span class=\"button-text\">Import</span>\n                    </button>\n                </e-ui-button>\n            </div>\n        </div>\n    `;\n    document.body.appendChild(wrapper);\n\n    const cancelButton = document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL_CANCEL_BUTTON') as HTMLButtonElement;\n    cancelButton.onclick = () => setModalVisible(false);\n\n    const fileInput = document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL_FILE_INPUT') as HTMLInputElement;\n    fileInput.onchange = () => {\n        const isSelected = fileInput.files && fileInput.files.length > 0;\n        let message = 'No files selected';\n        if (isSelected) {\n            message =\n                fileInput.files!.length === 1\n                    ? `${fileInput.files![0].name} selected`\n                    : `${fileInput.files!.length} files selected`;\n        }\n\n        document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL_FILE_INPUT_MESSAGE')!.innerHTML = message;\n\n        const wrapper = document.querySelector('#IMPORT_ALL_INITIATIVES_MODAL_IMPORT_BUTTON') as HTMLElement;\n        wrapper.classList.remove('disabled');\n        if (!isSelected) {\n            wrapper.classList.add('disabled');\n        }\n        if (isSelected) {\n            wrapper.onclick = () => {\n                startMassImport(fileInput.files!);\n                setModalVisible(false);\n            };\n        } else {\n            wrapper.onclick = null;\n        }\n    };\n}\n","import { PNPHelpers } from './scripts/helpers';\n\nfunction attemptToInitialize() {\n    if (PNPHelpers.isReadyToInitialize()) {\n        PNPHelpers.initialize();\n    }\n}\n\nsetInterval(() => {\n    attemptToInitialize();\n}, 500);\n","import { PNPDownloadAllButton } from '../components/download-all-initiatives-button';\nimport { PNPDeleteAllButton } from '../components/delete-all-initiatives-button';\nimport { PNPMassImportButton } from \"../components/mass-import-initiatives-button\";\n\nlet errorId = 0;\n\nexport namespace PNPHelpers {\n    export const headerSelector = 'e-ui-page-header e-ui-layout e-ui-col:nth-child(2)';\n\n    export function appendScript(url: string, id: string) {\n        if (document.querySelector(`#PLUG_AND_PLAY_INITIATIVES_SCRIPT_${id}`)) {\n            return Promise.resolve();\n        }\n        return new Promise<void>(resolve => {\n            const head = document.getElementsByTagName('head')[0];\n            const theScript = document.createElement('script');\n            theScript.type = 'text/javascript';\n            theScript.src = url;\n            theScript.id = `PLUG_AND_PLAY_INITIATIVES_SCRIPT_${id}`;\n            (theScript as any).onreadystatechange = () => resolve();\n            theScript.onload = () => resolve();\n            head.appendChild(theScript);\n        });\n    }\n\n    export function handleError(message: string, error?: unknown) {\n        if (!document.querySelector('#PLUG_AND_PLAY_INITIATIVES_ERROR_WRAPPER')) {\n            const div = document.createElement('div');\n            div.id = 'PLUG_AND_PLAY_INITIATIVES_ERROR_WRAPPER';\n            div.style.position = 'fixed';\n            div.style.top = '0';\n            div.style.left = '50%';\n            div.style.transform = 'translateX(-50%)';\n            document.body.appendChild(div);\n        }\n        const wrapper = document.querySelector('#PLUG_AND_PLAY_INITIATIVES_ERROR_WRAPPER')!;\n        const e = document.createElement('div');\n        e.style.textAlign = 'center';\n        e.style.marginTop = '10px';\n        e.style.background = '#fab3c3';\n        e.style.padding = '10px 20px';\n        e.style.borderRadius = '4px';\n        e.style.position = 'relative';\n        errorId++;\n        e.id = `DOWNLOAD_ALL_INITIATIVES_ERROR_${errorId}`;\n        e.innerHTML += `<b style=\"color: rgba(242, 65, 101, 1); font-size: 100%;\">Error ${errorId}</b>`;\n        e.innerHTML += `<span style=\"display: block\">${message}</span>`;\n        if (error) {\n            e.innerHTML += `<i style=\"display: block;font-size: 80%;\">Details in Dev. console</i>`;\n        }\n        e.innerHTML += `<b style=\"position: absolute; right: 0; top: 0; padding: 5px; display: block; cursor: pointer; opacity: 0.5;\" onclick=\"\n    document.querySelector('#DOWNLOAD_ALL_INITIATIVES_ERROR_${errorId}').remove()\n  \">X</b>`;\n        wrapper.appendChild(e);\n        if (error) {\n            console.error(`Error ${errorId}`, error);\n        }\n    }\n\n    export function getMajorVersionString() {\n        const fullVersion = (window.globalFrontendConfig || {}).app_frontend_version || '';\n        if (!fullVersion) {\n            return 'unknown';\n        }\n        const parts = fullVersion.split('.');\n        return parts[0] + '.' + parts[1];\n    }\n\n    export function isReadyToInitialize() {\n        return (\n            !!document.querySelector(headerSelector) &&\n            location.pathname.endsWith('/initiatives') &&\n            !document.querySelector('#DOWNLOAD_ALL_INITIATIVES_BUTTON_WRAPPER')\n        );\n    }\n\n    export async function initialize() {\n        PNPDownloadAllButton.create();\n        PNPDeleteAllButton.create();\n        PNPMassImportButton.create();\n        await appendScript(`//cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.min.js`, 'jszip');\n        await appendScript(`//cdn.jsdelivr.net/npm/file-saver@2.0.2/dist/FileSaver.min.js`, 'filesaver');\n        setButtonStatus(true);\n    }\n\n    export function setButtonStatus(enabled: boolean) {\n        PNPDownloadAllButton.setEnabled(enabled);\n        PNPDeleteAllButton.setEnabled(enabled);\n        PNPMassImportButton.setEnabled(enabled);\n    }\n}\n","export namespace PNPProject {\n    export function getProjectSlug() {\n        const regexResult = location.pathname.match(/\\/p\\/([^/]+)/);\n        if (!regexResult) {\n            return null;\n        }\n        return regexResult[1];\n    }\n\n    export function getProjectData() {\n        const slug = getProjectSlug();\n        if (!slug) {\n            return null;\n        }\n\n        return (window.globalCompanies || []).find(company => company.slug === slug);\n    }\n}\n","export class Deferred<T> implements Promise<T> {\n    [Symbol.toStringTag]: any;\n\n    public resolve!: (...rest: any[]) => void;\n    public reject: any;\n\n    public promise: Promise<T>;\n\n    constructor() {\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n\n    then<TResult1, TResult2>(\n        onfulfilled: (value: T) => PromiseLike<TResult1> | TResult1,\n        onrejected: (reason: any) => PromiseLike<TResult2> | TResult2,\n    ): Promise<TResult2 | TResult1>;\n    then<TResult>(\n        onfulfilled: (value: T) => PromiseLike<TResult> | TResult,\n        onrejected?: (reason: any) => PromiseLike<TResult> | TResult,\n    ): Promise<TResult>;\n    then(): Promise<T>;\n    then(onfulfilled?: any, onrejected?: any): any {\n        return this.promise.then(onfulfilled, onrejected);\n    }\n\n    catch<TResult>(onrejected: (reason: any) => PromiseLike<TResult> | TResult): Promise<TResult | T>;\n    catch(onrejected: (reason: any) => PromiseLike<T> | T): Promise<T>;\n    catch(onrejected: any): any {\n        return this.promise.catch(onrejected);\n    }\n\n    finally(onfinally?: (() => void) | undefined | null): Promise<T> {\n        throw new Error('NOT IMPLEMENTED');\n    }\n}\n","import { InitiativeExportData, InitiativeImportData, InitiativeListItem } from '../types/initiative.type';\nimport { PNPHelpers } from './helpers';\n\nexport namespace PNPInitiative {\n    export function getInitiativeListUrl(projectId: string) {\n        return `/api/initiatives?company_id=${projectId}`;\n    }\n\n    export function getInitiativeExportUrl(initiativeId: string, projectId: string) {\n        return `/api/project/data-management/initiatives/${initiativeId}/export?company_id=${projectId}`;\n    }\n\n    export function getInitiativeDeleteUrl(initiativeId: string, projectId: string) {\n        return `/api/initiatives/${initiativeId}?company_id=${projectId}`;\n    }\n\n    export function getInitiativeImportUrl(projectId: string) {\n        return `/api/project/data-management/initiatives/import?company_id=${projectId}`;\n    }\n\n    export function getInitiativeList(projectId: string) {\n        return fetch(getInitiativeListUrl(projectId), { credentials: 'same-origin' })\n            .then(response => response.json())\n            .then(response => response.data as InitiativeListItem[])\n            .catch(error => {\n                PNPHelpers.handleError('Could not download Initiative list', error);\n                return [] as InitiativeListItem[];\n            });\n    }\n\n    export function getInitiative(initiativeId: string, projectId: string) {\n        return fetch(getInitiativeExportUrl(initiativeId, projectId), {\n            credentials: 'same-origin',\n        })\n            .then(response => response.json() as Promise<InitiativeExportData>)\n            .catch(error => {\n                PNPHelpers.handleError(`Could not download Initiative ${initiativeId}`, error);\n                return null;\n            });\n    }\n\n    export function deleteInitiative(initiativeId: string, projectId: string) {\n        return fetch(getInitiativeDeleteUrl(initiativeId, projectId), {\n            credentials: 'same-origin',\n            method: 'DELETE',\n        })\n            .then(response => response.json() as Promise<{ success: boolean }>)\n            .catch(error => {\n                PNPHelpers.handleError(`Could not delete Initiative ${initiativeId}`, error);\n                return { success: false };\n            });\n    }\n\n    export function importInitiativeJson(json: string, projectId: string) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const fileOfBlob = new File([blob], 'file.json');\n        const formData = new FormData();\n        formData.append('files', fileOfBlob);\n\n        return fetch(getInitiativeImportUrl(projectId), {\n            credentials: 'same-origin',\n            method: 'POST',\n            body: formData,\n        })\n            .then(response => response.json() as Promise<InitiativeImportData>)\n            .catch(error => {\n                PNPHelpers.handleError(`Could not import Initiative`, error);\n                return null;\n            });\n    }\n}\n","import { InitiativeExportData, InitiativeListItem } from '../types/initiative.type';\nimport { asyncForEach } from '../../helpers';\nimport { PNPProject } from '../scripts/project-functions';\nimport { PNPHelpers } from '../scripts/helpers';\nimport { PNPInitiative } from '../scripts/initiative-functions';\nimport * as JSZipType from 'jszip';\nimport { saveAs as fileSaverSaveAs } from 'file-saver';\n\ndeclare const saveAs: typeof fileSaverSaveAs;\ndeclare const JSZip: JSZipType;\n\nlet total = 0;\nlet current = 0;\n\nexport namespace PNPDownloadAllButton {\n    export const create = createButton;\n    export const setEnabled = setButtonEnabled;\n}\n\nfunction createButton() {\n    if (document.querySelector('#DOWNLOAD_ALL_INITIATIVES_BUTTON_WRAPPER')) {\n        return;\n    }\n    const button = document.createElement('e-ui-button');\n    button.id = 'DOWNLOAD_ALL_INITIATIVES_BUTTON_WRAPPER';\n    button.classList.add('ui');\n    button.classList.add('ui-node');\n    button.innerHTML = `\n        <button class=\"button-wrapper\" id=\"DOWNLOAD_ALL_INITIATIVES_BUTTON\">\n            <span id=\"DOWNLOAD_ALL_INITIATIVES_BUTTON_TEXT\" class=\"button-text\">Download all</span>\n        </button>\n    `;\n    document.querySelector(PNPHelpers.headerSelector)!.prepend(button);\n    PNPHelpers.setButtonStatus(false);\n    updateButtonLabel();\n}\n\nfunction setButtonEnabled(enabled: boolean) {\n    const wrapper = document.querySelector('#DOWNLOAD_ALL_INITIATIVES_BUTTON_WRAPPER');\n    if (!wrapper) {\n        return;\n    }\n    wrapper.classList.remove('disabled');\n    if (!enabled) {\n        wrapper.classList.add('disabled');\n    }\n    const button = document.querySelector('#DOWNLOAD_ALL_INITIATIVES_BUTTON_WRAPPER') as HTMLButtonElement;\n    if (!button) {\n        return;\n    }\n    if (enabled) {\n        button.onclick = () => {\n            exportAllInitiatives();\n        };\n    } else {\n        button.onclick = null;\n    }\n}\n\nfunction updateButtonLabel() {\n    const text = document.querySelector('#DOWNLOAD_ALL_INITIATIVES_BUTTON_TEXT');\n    if (!text) {\n        return;\n    }\n    text.innerHTML = 'Download all';\n    if (total > 0) {\n        text.innerHTML += ` ${current} / ${total}`;\n    }\n}\n\nasync function exportAllInitiatives() {\n    const project = PNPProject.getProjectData();\n    if (!project) {\n        PNPHelpers.handleError('Could not find Project ID');\n        return;\n    }\n    const folderName = `${PNPHelpers.getMajorVersionString()}`;\n    const zipName = `${PNPHelpers.getMajorVersionString()} - ${project.company_name} - Initiatives.zip`;\n    PNPHelpers.setButtonStatus(false);\n    const list = await PNPInitiative.getInitiativeList(project._id);\n    current = 0;\n    total = list.length;\n    updateButtonLabel();\n    const failedInitiatives: [InitiativeListItem, InitiativeExportData | null][] = [];\n    const zip = new JSZip();\n    const folder = zip.folder(folderName)!;\n    await asyncForEach(list, async initiative => {\n        const initiativeData = await PNPInitiative.getInitiative(initiative._id, project._id);\n        current++;\n        updateButtonLabel();\n        if (!initiativeData) {\n            failedInitiatives.push([initiative, null]);\n            return;\n        }\n        if (initiativeData.errors) {\n            failedInitiatives.push([initiative, initiativeData]);\n            return;\n        }\n        const name = initiative.name.replace(/\\//g, '-').replace(/\\\\/g, '-');\n        const data = JSON.stringify(initiativeData);\n        const fileName = `${name}.json`;\n        folder.file(fileName, data);\n    });\n    failedInitiatives.forEach(fail => {\n        PNPHelpers.handleError(`${fail[0].name} (${fail[0]._id}) export failed`, fail[1]);\n    });\n    PNPHelpers.setButtonStatus(true);\n    total = 0;\n    updateButtonLabel();\n    return zip.generateAsync({ type: 'blob' }).then(content => {\n        saveAs(content, zipName);\n    });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import './main';\n"],"names":["sleep","ms","result","Deferred","setTimeout","resolve","promise","objectFromEntries","arr","Object","assign","Array","from","key","value","array","callback","index","length","file","reader","FileReader","onload","event","target","readAsText","fn","conditionFn","options","waitingInterval","maxTries","tryToGetResult","retry","then","Error","obj","filterFn","entries","filter","total","current","createButton","document","querySelector","button","createElement","id","setAttribute","classList","add","innerHTML","PNPHelpers","headerSelector","prepend","setButtonStatus","updateButtonLabel","setButtonEnabled","enabled","wrapper","remove","onclick","project","PNPProject","getProjectData","PNPInitiative","getInitiativeList","_id","handleError","list","prompt","alert","failedInitiatives","asyncForEach","initiative","deleteInitiative","response","success","push","forEach","fail","name","deleteAllInitiatives","text","PNPDeleteAllButton","create","setEnabled","setModalVisible","open","style","position","left","right","top","bottom","display","body","appendChild","fileInput","onchange","isSelected","files","message","handleFile","JSZip","loadAsync","fileKeys","keys","fileKey","f","dir","jsons","async","readFileAsText","importJson","json","importInitiativeJson","errors","fails","item","startMassImport","createMassImportModal","modal","PNPMassImportButton","setInterval","isReadyToInitialize","initialize","errorId","appendScript","url","Promise","head","getElementsByTagName","theScript","type","src","onreadystatechange","PNPDownloadAllButton","error","div","transform","e","textAlign","marginTop","background","padding","borderRadius","console","getMajorVersionString","fullVersion","window","globalFrontendConfig","app_frontend_version","parts","split","location","pathname","endsWith","getProjectSlug","regexResult","match","slug","globalCompanies","find","company","this","reject","onfulfilled","onrejected","catch","finally","onfinally","Symbol","toStringTag","getInitiativeListUrl","projectId","getInitiativeExportUrl","initiativeId","getInitiativeDeleteUrl","getInitiativeImportUrl","fetch","credentials","data","getInitiative","method","blob","Blob","fileOfBlob","File","formData","FormData","append","folderName","zipName","company_name","zip","folder","initiativeData","replace","JSON","stringify","fileName","generateAsync","content","saveAs","exportAllInitiatives","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call"],"ignoreList":[],"sourceRoot":""}